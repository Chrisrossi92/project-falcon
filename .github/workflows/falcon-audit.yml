name: Falcon Audit
on:
  pull_request:
    branches: [ main ]
jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - run: npm init -y
      - run: npm i -D @babel/parser @babel/traverse fast-glob picocolors madge
      - run: node scripts/analyze-deps.mjs || true
      - run: node scripts/inventory-to-md.mjs || true
      - name: Upload inventory & docs
        uses: actions/upload-artifact@v4
        with:
          name: falcon-inventory-and-docs
          path: |
            docs/inventory.json
            docs/components.md
            docs/pages.md
            docs/hooks.md
            docs/architecture.md
          if-no-files-found: ignore
